
<!-- ä¾§è¾¹å¯¼èˆª -->
<nav class="admin-sidebar">
    <div class="nav-title">ç®¡ç†é¢æ¿</div>
    <ul class="nav-menu">
        <li class="nav-item" data-panel="user"><a href="/administer/showUserModule">ğŸ‘¤ ç”¨æˆ·ç®¡ç†</a></li>
        <li class="nav-item" data-panel="comment"><a href="/administer/showCommentModule">ğŸ’¬ è¯„è®ºç®¡ç†</a></li>
        <li class="nav-item" data-panel="house"><a href="/administer/showHouseModule">ğŸ  ä½æˆ¿ç®¡ç†</a></li>
        <li class="nav-item active" data-panel="order"><a href="/administer/showOrderModule">ğŸ“¦ è®¢å•ç®¡ç†</a></li>
        <li class="nav-item" data-panel="stats"><a href="/administer/showStatsModule">ğŸ“Š æ•°æ®ç»Ÿè®¡</a></li>
    </ul>

    <ul>
        <li class="user-item">ç®¡ç†å‘˜ï¼š{{.userName}}</li>
        <li class="user-item"><a href="/administer/logout">é€€å‡º</a></li>
    </ul>
</nav>

<!-- ä¸»å†…å®¹åŒº -->
<main class="admin-main">
    <!-- è®¢å•ç®¡ç† -->
    <div class="dashboard-panel">
        <div class="panel-header">è®¢å•ç®¡ç†</div>
        <div class="search-bar">
            <form action="/administer/orderOperation" method="get">
                <input type="text" placeholder="æœç´¢è®¢å•..." name="orderName">
                <button type="submit" class="action-btn">æœç´¢</button>
            </form>
        </div>
        <table class="data-table">
            <thead>
            <tr>
                <th>åç§°</th>
                <th>ä»·æ ¼</th>
                <th>è®¢å•å·</th>
                <th>ä¸‹å•æ—¶é—´</th>
                <th>è”ç³»æ–¹å¼</th>
                <th>è®¢å•çŠ¶æ€</th>
                <th>æ“ä½œ</th>
            </tr>
            </thead>
            <tbody>
            {{range .goodsBuffer}}
                <tr>
                    {{range .orderGoods}}
                        <td style="display: block"><img src="http://192.168.117.132:8888/{{.GoodsSKU.Image}}" alt="">
                            <em>åç§°ï¼š{{.GoodsSKU.Name}}</em>
                            <em>åœ°å€ï¼š{{.GoodsSKU.Addr}}</em>
                        </td>
                    {{end}}
                    <td>{{.orderInfo.TotalPrice}}å…ƒ</td>
                    <td>{{.orderInfo.OrderId}}</td>
                    <td>{{.orderInfo.Time}}</td>
                    <td>
                        {{range .orderGoods}}
                        <em>æˆ¿ä¸œï¼š{{.GoodsSKU.Phone}}</em>
                        {{end}}
                        <em>ç§Ÿå®¢ï¼š{{.orderInfo.Address.Phone}}</em>
                    </td>
                    {{if compare .orderInfo.OrderStatus 1}}
                        <td>âœ… å·²å®Œæˆ</td>
                        <td>â€”â€”</td>
                    {{else}}
                        <td>âŒ æœªå®Œæˆ</td>
                        <td hidden="hidden" class="Id">{{.orderInfo.Id}}</td>
                        <td>
                            {{if compare .orderInfo.ConfirmStatus 0}}
                            <button class="action-btn order-confirm-btn">ç¡®è®¤</button>
                            {{end}}
                            <button class="action-btn order-delete-btn">å–æ¶ˆ</button>
                        </td>
                    {{end}}
                </tr>
            {{end}}
            </tbody>
        </table>
    </div>
</main>

<script>
    $(document).ready(function() {
        // è®¢å•ç¡®è®¤æŒ‰é’®
        $('.order-confirm-btn').click(function () {
            if(confirm('ç¡®è®¤è¯¥è®¢å•ï¼Ÿ')) {
                const $row = $(this).closest('tr');
                const Id = $row.find('.Id').text().trim();
                param = {'Id': Id}
                $.ajaxSettings.async = false
                $.post('/administer/orderConfirm',param, function(response) {
                    if (response.code === 0) {
                        // ç§»é™¤ç¡®è®¤æŒ‰é’®å…ƒç´ 
                        $('.order-confirm-btn').fadeOut(300, () => $(this).remove());
                    } else {
                        alert(response.msg);
                    }
                });
                $.ajaxSettings.async = false
            }
        })

        // è®¢å•å–æ¶ˆæŒ‰é’®
        $('.order-delete-btn').click(function () {
            if(confirm('ç¡®å®šå–æ¶ˆè¯¥è®¢å•ï¼Ÿ')) {
                const $row = $(this).closest('tr');
                const Id = $row.find('.Id').text().trim();
                param = {'Id': Id}
                $.ajaxSettings.async = false
                $.post('/administer/orderOperation',param, function(response) {
                    if (response.code === 0) {
                        // ç§»é™¤å¯¹åº”å…ƒç´ 
                        $row.fadeOut(300, () => $row.remove());
                    } else {
                        alert(response.msg);
                    }
                });
                $.ajaxSettings.async = false
            }
        })
    });
</script>